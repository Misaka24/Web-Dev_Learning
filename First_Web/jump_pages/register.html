<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>注册页面</title>
</head>
<body>
  <h2>用户注册表单</h2>
  <form id="register-form">
    <div>
      <label for="username">用户名：</label>
      <input type="text" id="username" name="username" placeholder="请输入用户名" required />
    </div>
    <br />
    <div>
      <label for="email">邮箱：</label>
      <input type="email" id="email" name="email" placeholder="请输入邮箱" required />
    </div>
    <br />
    <div>
      <label for="password">密码：</label>
      <input type="password" id="password" name="password" placeholder="请输入密码" required />
    </div>
    <br />
    <div>
      <label>性别：</label>
      <input type="radio" id="male" name="gender" value="male" />
      <label for="male">男</label>
      <input type="radio" id="female" name="gender" value="female" />
      <label for="female">女</label>
    </div>
    <br />
    <div>
      <label for="hobbies">爱好：</label>
      <select id="hobbies" name="hobbies" multiple size="1">
        <option value="reading">阅读</option>
        <option value="music">音乐</option>
        <option value="sports">运动</option>
        <option value="coding">编程</option>
      </select>
    </div>
    <br />
    <div>
      <label for="bio">个人简介：</label>
      <textarea id="bio" name="bio" rows="4" cols="50" placeholder="请输入个人简介"></textarea>
    </div>
    <br />
    <div>
      <input type="checkbox" id="agreement" name="agreement" required />
      <label for="agreement">我已阅读并同意用户协议</label>
    </div>
    <br />
    <div>
      <input type="submit" value="注册" />
      <input type="reset" value="重置" />
    </div>
  </form>
  <p>已有账号？<a href="../index.html">去登录</a></p>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("register-form");
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
        data.hobbies = Array.from(form.querySelectorAll("#hobbies option:checked")).map(o => o.value);

        try {
          const res = await fetch("/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
          });
          const result = await res.json();
          alert(result.message);
          if (res.ok && result.success) window.location.href = "../index.html";
        } catch (err) {
          alert("请求出错：" + err);
        }
      });
    });
  </script>
</body>
</html>
